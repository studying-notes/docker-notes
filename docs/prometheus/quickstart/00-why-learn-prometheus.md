---
date: 2022-07-03T10:38:47+08:00
author: "Rustle Karl"

title: "00 为什么要学 Prometheus"
url:  "posts/docker/docs/prometheus/quickstart/00-why-learn-prometheus"  # 永久链接
tags: [ "Docker", "Prometheus" ]  # 标签
categories: [ "Prometheus 入门教程" ]  # 分类

toc: true  # 目录
draft: true  # 草稿
---

## 起因

起因就是我将两台树莓派和一台淘汰笔记本作为服务器，跑了不少服务。

由于经常由于防火墙（一台装了 OpenWrt，防火墙关了会被其他程序重启）或者其他原因导致服务不可用。

于是我就想着必须监控这些端口，保证可访问，不可访问时通知我。

然后，我自己写了个程序，用 Prefect 做调度，通过解析 docker-compose.yml 获取开放的端口，然后通过 TCP 测试是否可访问，不可访问则通过 Telegram 通知我。

功能很简单，但是由于监控程序是 Go 写的（Docker Python SDK 太久不更新了，所以决定用 Go），而 Prefect 是 Python 写的，中间是通过子进程方式调用的，Prefect 是分布式的，会导致各种问题。

所以在由 TeamCity 转向 Drone 后，我就停止了这个监控方式。

## 相遇

我之前买了一个摄像头，然后笔记本也有个摄像头，硬盘空间很多，我就想不能闲置，打算监控房间。

于是找有没有开源的视频监控系统，最终发现没用能用的。最后还是用了 FFmeg 推流。另一端保存。

无聊中搜了服务器监控系统，各种信息中发现了 Prometheus，之前在部署 SeaweedFS 时似乎见到过，看了一眼，确实，然后就相遇了。

决定重启服务监控。

## 什么是 Prometheus？

Prometheus（普罗米修斯）是古希腊的一个神明，名字的意思是「先见之明」。从它的名字可以看出，Prometheus 是做「先见之明」的监控告警用途。

**Prometheus 其实就是一个数据监控解决方案，它能帮你简单快速地搭建起一套可视化的监控系统。** 

对于运维人员来说，他们需要监控机器的 CPU、内存、硬盘的使用情况，以此来保证运行在机器上的应用的稳定性。

对于研发人员来说，他们关注某个异常指标的变化情况，从而来保证业务的稳定运行。

对于产品或运营来说，他们更关心产品层面的事情，例如：某个活动参加人数的增长情况，活动积分的发放情况。

![img](http://dd-static.jd.com/ddimg/jfs/t1/50949/13/19996/79074/62c10206Ebddb7eb8/e5d090256471a29c.jpg)

对于上面说到的这些功能，Prometheus 都能够实现。Prometheus 能根据这些收集的数据实现告警功能。

例如：运维希望在 CPU 达到 80% 的时候给值班的运维人员发送邮件，产品希望活动积分发放数量超过 10 万的时候发送告警邮件。这些都可以通过 Prometheus 实现。

除了数据收集、告警功能之外，Prometheus 还有很多强大的功能，例如：强大的 ProQL 查询、许多客户端库等。

![img](http://dd-static.jd.com/ddimg/jfs/t1/87070/9/29864/75971/62c10205Ef0b74ce1/7a78c6be84f7bd08.jpg)

因为 Prometheus 功能强大、构建成本低，所以现在越来越多的公司都使用 Prometheus 作为其数据监控的解决方案。

![img](http://dd-static.jd.com/ddimg/jfs/t1/55647/1/20551/68854/62c10206Ef3be143a/dcff771cc04252f3.jpg)

## 为什么要学 Prometheus？

对于一直在一线开发的同学而言，你可能只需要把自己的需求做好、没有 bug、顺利上线，那么你的任务就完成了。

但是如果你是一个 leader，那么你是对整个业务系统负责，这个业务系统出了什么问题，都是你的责任。这个时候，你需要时刻关注这个系统是否正常运行。

对于流量不是很大的系统来说，出现几分钟的故障可能造成不了多少损失。但是对于像淘宝、美团、字节跳动这样的巨无霸来说，宕机 1 分钟损失的金额可能就是几百万！

所以弄清楚此时此刻系统的运行是否正常？各项业务指标是否超过阈值？这些问题是每个经验丰富的研发人员所需要关注的事情！

那么如何监控你的系统？如何得知系统目前是正常还是异常？甚至如何预知未来一段时间系统可能出问题？**Prometheus 正是这么一套数据监控解决方案。它能让你随时掌控系统的运行状态，快速定位出现问题的位置，快速排除故障。**

只要按照 Prometheus 的方式来做，按部就班地学习和部署，我们就可以监控机器的 CPU、内存等资源的使用情况、Java 应用的运行情况以及业务各项指标的实时数据。

当然有一些公司会自己使用 Kafaka 收集监控数据，并且存储在 Hive 中，最终通过页面聚合数据，同样能够实现数据监控。但是这种解决方案需要开发人员掌握 Hive + Hadoop 等大数据框架，并且在前端展示上比较局限。

而通过 Prometheus 则可以直接部署使用，并且其与 Grafana 配套使用可以呈现出非常多样化的图表配置。**对于中小规模的团队来说，可以极大地减少成本，加快研发速度。**

而对于个人来讲，**掌握 Prometheus 可以增加你当 leader 的竞争力。** 毕竟如果一个研发对自己的系统运行状况都不了解，那么他怎么做 leader，怎么带领一个团队往前冲呢？
